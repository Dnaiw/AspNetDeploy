@model AspNetDeploy.WebUI.Models.WebSiteDeploymentStepModel

@{
    ViewBag.Title = "Index";
    ViewBag.PageClass = "deploymetStepPage";

    Layout = "~/Views/Shared/_Layout.cshtml";
    DeploymentStep deploymentStep = this.ViewBag.DeploymentStep;
    BundleVersion bundleVersion = deploymentStep.BundleVersion;
}

<div class="container">
    
    <script src="~/Resources/JavaScripts/Ace/Ace.js" type="text/javascript"></script>
    <script src="~/Resources/JavaScripts/Ace/ext-searchbox.js" type="text/javascript"></script>
    <script src="~/Resources/JavaScripts/Ace/mode-xml.js" type="text/javascript"></script>
    <script src="~/Resources/JavaScripts/Ace/mode-json.js" type="text/javascript"></script>
    <script src="~/Resources/JavaScripts/Ace/theme-textmate.js" type="text/javascript"></script>
    <script src="~/Resources/JavaScripts/Ace/autocomplete/popup.js"></script>
    <script src="~/Resources/JavaScripts/Ace/autocomplete/text_completer.js"></script>
    <script src="~/Resources/JavaScripts/Ace/autocomplete/util.js"></script>
    <script src="~/Resources/JavaScripts/Ace/autocomplete.js"></script>
    <script src="~/Resources/JavaScripts/Ace/snippets.js"></script>
    <script src="~/Resources/JavaScripts/Ace/language_tools.js"></script>
    <script src="~/Resources/JavaScripts/Editor.js" type="text/javascript"></script>
    <script src="~/Resources/JavaScripts/shortcut.js" type="text/javascript"></script>

    <h1>
        <div class="row">
            <div class="col-md-10">
                @bundleVersion.Bundle.Name @bundleVersion.Name <small>Bundle</small>
            </div>
            <div class="col-md-2 text-right">
                <button class="btn btn-default btn-lg">Configure</button>
            </div>
        </div>
    </h1>

    <hr />

    <ul class="nav nav-pills" role="tablist">
        <li role="presentation"><a href="@Url.Action("VersionProjects", "Bundles", new { id = bundleVersion.Id })">Projects</a></li>
        <li role="presentation" class="active"><a href="@Url.Action("VersionDeployment", "Bundles", new { id = bundleVersion.Id })">Deployment process</a></li>
        <li role="presentation"><a href="@Url.Action("VersionPackages", "Bundles", new { id = bundleVersion.Id })">Packages & Publications</a></li>
    </ul>

    <hr />

    <h3>@deploymentStep.OrderIndex. Deploy: @deploymentStep.GetStringProperty("Step.Title") <small>Configuration</small></h3>

    @using (Html.BeginForm("UpdateWebSiteDeploymentStep", "BundleVersionDeployment", new { }, FormMethod.Post, new { id = "idForm", Class = "form-horizontal" }))
    {
        @Html.HiddenFor(m => m.DeploymentStepId)

        <p>config JSON</p>
        
        <div class="container-fluid">
            <div id="idEditor" style="border: 1px solid #999;"></div>
        </div>
        <hr/>
        <button type="submit" class="btn btn-default">Сохранить</button>
    }
    
    <script>


        $(function() {

            var editor = new Studio.Editor();

            function resize()
            {
                var editorContainer = $('#idEditor');

                editorContainer.css({
                    height: 500
                });

                editor.resize();
            }


            editor.initialize({
                containerId: 'idEditor',
                readOnly: false
            });

            editor.value($('#ConfigJson').val());

            $('#idForm').submit(function () {
                $('#ConfigJson').val(editor.value());
            });

            resize();
            $(window).resize(Common.Timers.startWithDelay(resize, 100));

        })

    </script>


</div>
